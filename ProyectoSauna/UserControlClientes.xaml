<UserControl x:Class="ProyectoSauna.UserControlClientes"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:converters="clr-namespace:ProyectoSauna.Converters"
             xmlns:system="clr-namespace:System;assembly=mscorlib"
             Background="#14161C">
    
    <UserControl.Resources>
        <!-- Converters -->
    <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
    <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    <converters:StringEqualsConverter x:Key="StringEqualsConverter"/>
        
        <!-- Estilo global para TextBox -->
        <Style TargetType="TextBox" BasedOn="{StaticResource MaterialDesignOutlinedTextBox}">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="CaretBrush" Value="#4CC9F0"/>
            <Setter Property="BorderBrush" Value="#6B7280"/>
        </Style>
        
        <!-- Estilo global para DatePicker -->
        <Style TargetType="DatePicker" BasedOn="{StaticResource MaterialDesignOutlinedDatePicker}">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#6B7280"/>
        </Style>
        
        <!-- Estilo para el texto del DatePicker -->
        <Style TargetType="DatePickerTextBox">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Background" Value="Transparent"/>
        </Style>
    </UserControl.Resources>
    
    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Encabezado Compacto -->
        <Border Grid.Row="0" Background="#1E2128" CornerRadius="8" Padding="15,12" Margin="0,0,0,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <materialDesign:PackIcon Grid.Column="0" Kind="AccountGroup" Width="28" Height="28" Foreground="#4CC9F0" VerticalAlignment="Center"/>
                <StackPanel Grid.Column="1" Margin="12,0,0,0" VerticalAlignment="Center">
                    <TextBlock Text="Gestion de Clientes" FontSize="18" FontWeight="SemiBold" Foreground="White"/>
                    <TextBlock Text="Administracion de clientes activos del sistema" FontSize="11" Foreground="#6B7280" Margin="0,2,0,0"/>
                </StackPanel>
                
                <!-- Contador de clientes -->
                <Border Grid.Column="2" Background="#4CC9F022" CornerRadius="6" Padding="12,6">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="AccountMultiple" Width="16" Height="16" Foreground="#4CC9F0" VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding Clientes.Count, StringFormat='{}{0} activos'}" 
                                   Foreground="#4CC9F0" FontSize="12" FontWeight="Medium" Margin="6,0,0,0" VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <!-- Contenido Principal -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="380"/>
                <ColumnDefinition Width="12"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Panel Izquierdo: Formulario Compacto -->
            <Border Grid.Column="0" Background="#1E2128" CornerRadius="8" Padding="16">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <!-- Totulo del formulario -->
                        <Grid Margin="0,0,0,16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <materialDesign:PackIcon Grid.Column="0" Kind="FormTextbox" Width="18" Height="18" Foreground="#4CC9F0" VerticalAlignment="Center"/>
                            <TextBlock Grid.Column="1" Text="{Binding TextoBotonGuardar}" FontSize="15" FontWeight="SemiBold" Foreground="White" Margin="8,0,0,0" VerticalAlignment="Center"/>
                        </Grid>

                        <!-- Nombre y Apellidos en grid -->
                        <Grid Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="8"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Nombre *" Foreground="#9CA3AF" FontSize="11" Margin="0,0,0,4" FontWeight="Medium"/>
                                <TextBox Text="{Binding Nombre, UpdateSourceTrigger=PropertyChanged}"
                                         materialDesign:HintAssist.Hint="Ej: Juan"
                                         materialDesign:HintAssist.Foreground="#6B7280"
                                         materialDesign:HintAssist.IsFloating="False"
                                         materialDesign:TextFieldAssist.TextBoxViewMargin="1 0 1 0"
                                         Padding="12,10"
                                         FontSize="16"
                                         Height="42"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="2">
                                <TextBlock Text="Apellidos *" Foreground="#9CA3AF" FontSize="11" Margin="0,0,0,4" FontWeight="Medium"/>
                                <TextBox Text="{Binding Apellidos, UpdateSourceTrigger=PropertyChanged}"
                                         materialDesign:HintAssist.Hint="Ej: Porez"
                                         materialDesign:HintAssist.Foreground="#6B7280"
                                         materialDesign:HintAssist.IsFloating="False"
                                         materialDesign:TextFieldAssist.TextBoxViewMargin="1 0 1 0"
                                         Padding="12,10"
                                         FontSize="16"
                                         Height="42"/>
                            </StackPanel>
                        </Grid>

                        <!-- DNI y Telofono en grid -->
                        <Grid Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="8"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="DNI *" Foreground="#9CA3AF" FontSize="11" Margin="0,0,0,4" FontWeight="Medium"/>
                                <TextBox Text="{Binding NumeroDocumento, UpdateSourceTrigger=PropertyChanged}"
                                         materialDesign:HintAssist.Hint="8 digitos"
                                         materialDesign:HintAssist.Foreground="#6B7280"
                                         materialDesign:HintAssist.IsFloating="False"
                                         materialDesign:TextFieldAssist.TextBoxViewMargin="1 0 1 0"
                                         Padding="12,10"
                                         MaxLength="8"
                                         FontSize="16"
                                         Height="42"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="2">
                                <TextBlock Text="Telofono" Foreground="#9CA3AF" FontSize="11" Margin="0,0,0,4" FontWeight="Medium"/>
                                <TextBox Text="{Binding Telefono, UpdateSourceTrigger=PropertyChanged}"
                                         materialDesign:HintAssist.Hint="9 digitos"
                                         materialDesign:HintAssist.Foreground="#6B7280"
                                         materialDesign:HintAssist.IsFloating="False"
                                         materialDesign:TextFieldAssist.TextBoxViewMargin="1 0 1 0"
                                         Padding="12,10"
                                         MaxLength="9"
                                         FontSize="16"
                                         Height="42"/>
                            </StackPanel>
                        </Grid>

                        <!-- Correo -->
                        <StackPanel Margin="0,0,0,12">
                            <TextBlock Text="Correo Electronico" Foreground="#9CA3AF" FontSize="11" Margin="0,0,0,4" FontWeight="Medium"/>
                            <TextBox Text="{Binding Correo, UpdateSourceTrigger=PropertyChanged}"
                                     materialDesign:HintAssist.Hint="ejemplo@correo.com"
                                     materialDesign:HintAssist.Foreground="#6B7280"
                                     materialDesign:HintAssist.IsFloating="False"
                                     materialDesign:TextFieldAssist.TextBoxViewMargin="1 0 1 0"
                                     Padding="12,10"
                                     FontSize="16"
                                     Height="42"/>
                        </StackPanel>

                        <!-- Direccion -->
                        <StackPanel Margin="0,0,0,12">
                            <TextBlock Text="Direccion" Foreground="#9CA3AF" FontSize="11" Margin="0,0,0,4" FontWeight="Medium"/>
                            <TextBox Text="{Binding Direccion, UpdateSourceTrigger=PropertyChanged}"
                                     materialDesign:HintAssist.Hint="Av. Principal 123"
                                     materialDesign:HintAssist.Foreground="#6B7280"
                                     materialDesign:HintAssist.IsFloating="False"
                                     materialDesign:TextFieldAssist.TextBoxViewMargin="1 0 1 0"
                                     Padding="12,10"
                                     FontSize="16"
                                     Height="42"/>
                        </StackPanel>

                        <!-- Fecha de Nacimiento -->
                        <StackPanel Margin="0,0,0,20">
                            <TextBlock Text="Fecha de Nacimiento" Foreground="#9CA3AF" FontSize="11" Margin="0,0,0,4" FontWeight="Medium"/>
                            <DatePicker SelectedDate="{Binding FechaNacimiento, UpdateSourceTrigger=PropertyChanged}"
                                        materialDesign:HintAssist.Hint="DD/MM/AAAA"
                                        materialDesign:HintAssist.Foreground="#6B7280"
                                        materialDesign:HintAssist.IsFloating="False"
                                        Padding="12,10"
                                        FontSize="16"
                                        Height="42"/>
                        </StackPanel>

                        <!-- Botones -->
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Stretch">
                            <Button Command="{Binding GuardarClienteCommand}"
                                    Style="{StaticResource MaterialDesignRaisedButton}"
                                    Background="#4CC9F0"
                                    BorderBrush="#4CC9F0"
                                    Foreground="#14161C"
                                    Height="38"
                                    FontWeight="SemiBold"
                                    FontSize="13"
                                    HorizontalAlignment="Stretch"
                                    Margin="0,0,8,0">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="ContentSave" Width="16" Height="16" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding TextoBotonGuardar}" Margin="6,0,0,0" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                            
                            <Button Click="btnLimpiar_Click"
                                    Style="{StaticResource MaterialDesignOutlinedButton}"
                                    BorderBrush="#6B7280"
                                    Foreground="#9CA3AF"
                                    Height="38"
                                    FontWeight="Medium"
                                    FontSize="13"
                                    Width="90">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Close" Width="16" Height="16" VerticalAlignment="Center"/>
                                    <TextBlock Text="Limpiar" Margin="4,0,0,0" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>

                        <!-- Botón Desactivar (solo visible si hay cliente seleccionado) -->
                        <Button Command="{Binding DesactivarClienteCommand}"
                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                BorderBrush="#EF4444"
                                Foreground="#EF4444"
                                Height="38"
                                FontWeight="Medium"
                                FontSize="13"
                                Margin="0,12,0,0"
                                Visibility="{Binding ClienteSeleccionado, Converter={StaticResource NullToVisibilityConverter}}">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="AccountOff" Width="16" Height="16" VerticalAlignment="Center"/>
                                <TextBlock Text="Desactivar Cliente" Margin="6,0,0,0" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>

                        <TextBlock Text="* Campos obligatorios" 
                                   Foreground="#6B7280" 
                                   FontSize="10" 
                                   Margin="0,12,0,0"
                                   FontStyle="Italic"/>
                    </StackPanel>
                </ScrollViewer>
            </Border>

            <!-- Panel Derecho: Lista y Bosqueda -->
            <Border Grid.Column="2" Background="#1E2128" CornerRadius="8" Padding="16">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Panel de Bosqueda Compacto -->
                    <Grid Grid.Row="0" Margin="0,0,0,12">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Totulo de seccion -->
                        <Grid Grid.Row="0" Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <materialDesign:PackIcon Grid.Column="0" Kind="Magnify" Width="18" Height="18" Foreground="#4CC9F0" VerticalAlignment="Center"/>
                            <TextBlock Grid.Column="1" Text="Buscar Clientes" FontSize="15" FontWeight="SemiBold" Foreground="White" Margin="8,0,0,0" VerticalAlignment="Center"/>
                        </Grid>

                        <!-- Bosqueda y controles -->
                        <Grid Grid.Row="1">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <!-- RadioButtons compactos -->
                            <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="0,0,12,0" VerticalAlignment="Center">
                                <RadioButton Content="DNI" 
                                             IsChecked="{Binding TipoBusqueda, Converter={StaticResource StringEqualsConverter}, ConverterParameter=DNI, Mode=TwoWay}"
                                             Foreground="#9CA3AF" 
                                             FontSize="12"
                                             Margin="0,0,12,0"
                                             Style="{StaticResource MaterialDesignRadioButton}"/>
                                <RadioButton Content="Nombre" 
                                             IsChecked="{Binding TipoBusqueda, Converter={StaticResource StringEqualsConverter}, ConverterParameter=Nombre, Mode=TwoWay}"
                                             Foreground="#9CA3AF"
                                             FontSize="12"
                                             Style="{StaticResource MaterialDesignRadioButton}"/>
                            </StackPanel>

                            <!-- Barra de Bosqueda -->
                            <TextBox Grid.Column="1"
                                     Text="{Binding TextoBusqueda, UpdateSourceTrigger=PropertyChanged}"
                                     materialDesign:HintAssist.Hint="Buscar..."
                                     materialDesign:HintAssist.Foreground="#6B7280"
                                     materialDesign:HintAssist.IsFloating="False"
                                     materialDesign:TextFieldAssist.TextBoxViewMargin="1 0 1 0"
                                     Padding="12,8"
                                     FontSize="15"
                                     Height="40"
                                     Margin="0,0,8,0"
                                     PreviewTextInput="Buscador_PreviewTextInput"/>

                            <Button Grid.Column="2"
                                    Command="{Binding BuscarClienteCommand}"
                                    Style="{StaticResource MaterialDesignRaisedButton}"
                                    Background="#4CC9F0"
                                    Foreground="#14161C"
                                    Width="90"
                                    Height="40"
                                    Margin="0,0,8,0"
                                    FontWeight="Medium"
                                    FontSize="13">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Magnify" Width="16" Height="16" VerticalAlignment="Center"/>
                                    <TextBlock Text="Buscar" Margin="4,0,0,0" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>

                            <Button Grid.Column="3"
                                    Command="{Binding MostrarTodosCommand}"
                                    Style="{StaticResource MaterialDesignOutlinedButton}"
                                    BorderBrush="#6B7280"
                                    Foreground="#9CA3AF"
                                    Width="80"
                                    Height="40"
                                    FontWeight="Medium"
                                    FontSize="13">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="FormatListBulleted" Width="16" Height="16" VerticalAlignment="Center"/>
                                    <TextBlock Text="Todos" Margin="4,0,0,0" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                        </Grid>
                    </Grid>

                    <!-- DataGrid Mejorado -->
                    <Border Grid.Row="1" BorderBrush="#2D3748" BorderThickness="1" CornerRadius="6">
                        <DataGrid ItemsSource="{Binding Clientes}"
                                  SelectedItem="{Binding ClienteSeleccionado}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  IsReadOnly="True"
                                  Background="Transparent"
                                  Foreground="White"
                                  RowBackground="#1E2128"
                                  AlternatingRowBackground="#252830"
                                  BorderThickness="0"
                                  GridLinesVisibility="Horizontal"
                                  HorizontalGridLinesBrush="#2D3748"
                                  SelectionMode="Single"
                                  HeadersVisibility="Column"
                                  FontSize="12"
                                  RowHeight="40">
                            
                            <DataGrid.ColumnHeaderStyle>
                                <Style TargetType="DataGridColumnHeader">
                                    <Setter Property="Background" Value="#252830"/>
                                    <Setter Property="Foreground" Value="#9CA3AF"/>
                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                    <Setter Property="FontSize" Value="11"/>
                                    <Setter Property="Padding" Value="12,8"/>
                                    <Setter Property="BorderThickness" Value="0,0,0,1"/>
                                    <Setter Property="BorderBrush" Value="#2D3748"/>
                                    <Setter Property="HorizontalContentAlignment" Value="Left"/>
                                </Style>
                            </DataGrid.ColumnHeaderStyle>

                            <DataGrid.CellStyle>
                                <Style TargetType="DataGridCell">
                                    <Setter Property="BorderThickness" Value="0"/>
                                    <Setter Property="Padding" Value="12,0"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="DataGridCell">
                                                <Border Background="{TemplateBinding Background}" 
                                                        BorderThickness="{TemplateBinding BorderThickness}"
                                                        Padding="{TemplateBinding Padding}">
                                                    <ContentPresenter VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter Property="Background" Value="#4CC9F022"/>
                                            <Setter Property="Foreground" Value="White"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGrid.CellStyle>
                            
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="DNI" Binding="{Binding numero_documento}" Width="85">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="FontWeight" Value="Medium"/>
                                            <Setter Property="Foreground" Value="#4CC9F0"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="Nombre Completo" Binding="{Binding NombreCompleto}" Width="*" MinWidth="180"/>
                                <DataGridTextColumn Header="Teléfono" Binding="{Binding telefono}" Width="100"/>
                                <DataGridTextColumn Header="Correo" Binding="{Binding correo}" Width="200"/>
                                <DataGridTextColumn Header="Visitas" Binding="{Binding visitasTotales}" Width="60">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="HorizontalAlignment" Value="Center"/>
                                            <Setter Property="FontWeight" Value="SemiBold"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="Estado" Binding="{Binding Estado}" Width="70">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="HorizontalAlignment" Value="Center"/>
                                            <Setter Property="FontWeight" Value="Medium"/>
                                            <Setter Property="Foreground" Value="#10B981"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                            </DataGrid.Columns>

                            <DataGrid.RowStyle>
                                <Style TargetType="DataGridRow">
                                    <Setter Property="Cursor" Value="Hand"/>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#2D3748"/>
                                        </Trigger>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter Property="Background" Value="#4CC9F022"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGrid.RowStyle>
                        </DataGrid>
                    </Border>
                </Grid>
            </Border>
        </Grid>
        
        <!-- Barra de Estado -->
        <Border Grid.Row="2" Background="#1E2128" CornerRadius="8" Padding="12,8" Margin="0,12,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- Indicador de carga -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <ProgressBar IsIndeterminate="True" Width="100" Height="4" Margin="0,0,12,0"/>
                    <TextBlock Text="Procesando..." Foreground="#4CC9F0" FontSize="11" VerticalAlignment="Center"/>
                </StackPanel>
                
                <!-- Mensaje de estado -->
                <TextBlock Grid.Column="1" 
                           Text="{Binding MensajeEstado}" 
                           Foreground="#9CA3AF" 
                           FontSize="11" 
                           VerticalAlignment="Center"
                           TextTrimming="CharacterEllipsis"
                           Margin="12,0,0,0"/>
                
                <!-- Timestamp -->
                <TextBlock Grid.Column="2" 
                           Text="{Binding Source={x:Static system:DateTime.Now}, StringFormat='Actualizado: {0:HH:mm:ss}'}" 
                           Foreground="#6B7280" 
                           FontSize="10" 
                           VerticalAlignment="Center"
                           Margin="12,0,0,0"/>
            </Grid>
        </Border>
    </Grid>
</UserControl>


