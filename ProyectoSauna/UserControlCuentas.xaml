<UserControl x:Class="ProyectoSauna.UserControlCuentas"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:vm="clr-namespace:ProyectoSauna.ViewModels"
             xmlns:conv="clr-namespace:ProyectoSauna.Converters"
             Background="#0F1115">
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <conv:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
        <conv:GreaterThanZeroConverter x:Key="GreaterThanZeroConverter"/>

        <Style TargetType="TextBox" BasedOn="{StaticResource MaterialDesignOutlinedTextBox}">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="CaretBrush" Value="#4CC9F0"/>
            <Setter Property="BorderBrush" Value="#374151"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="MinHeight" Value="36"/>
        </Style>

        <Storyboard x:Key="ExpandDevolucion">
            <DoubleAnimation Storyboard.TargetName="DevolucionPanel" 
                           Storyboard.TargetProperty="Height"
                           From="0" To="145" Duration="0:0:0.3">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>

        <Storyboard x:Key="CollapseDevolucion">
            <DoubleAnimation Storyboard.TargetName="DevolucionPanel" 
                           Storyboard.TargetProperty="Height"
                           To="0" Duration="0:0:0.3">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseIn"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>
    </UserControl.Resources>

    <UserControl.DataContext>
        <vm:CuentasViewModel/>
    </UserControl.DataContext>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="#1A1D24" CornerRadius="6" Padding="12,8" Margin="0,0,0,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <materialDesign:PackIcon Kind="Receipt" Width="20" Height="20" Foreground="#4CC9F0" VerticalAlignment="Center"/>
                    <TextBlock Text="Cuentas y Consumos" FontSize="15" FontWeight="SemiBold" Foreground="White" Margin="10,0,0,0" VerticalAlignment="Center"/>
                </StackPanel>

                <Border Grid.Column="2" Background="#22C55E18" BorderBrush="#22C55E" BorderThickness="1" CornerRadius="5" Padding="10,4">
                    <StackPanel Orientation="Horizontal">
                        <Ellipse Width="7" Height="7" Fill="#22C55E" VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding CuentasPendientes.Count, StringFormat='{}{0} pendientes'}" 
                                 Foreground="#22C55E" FontSize="11" FontWeight="SemiBold" Margin="8,0,0,0" VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <!-- Banner Cuenta Activa -->
        <Border Grid.Row="1" 
                Background="#1E3A8A" 
                CornerRadius="6" 
                Padding="12,7" 
                Margin="0,0,0,8"
                BorderBrush="#3B82F6"
                BorderThickness="1"
                Visibility="{Binding HayCuentaActiva, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Border Grid.Column="0" Background="#2563EB" CornerRadius="5" Padding="8,5" BorderBrush="#60A5FA" BorderThickness="1">
                    <StackPanel Orientation="Horizontal">
                        <Ellipse Width="7" Height="7" Fill="#22C55E" VerticalAlignment="Center"/>
                        <TextBlock Text="ACTIVA" FontSize="10" FontWeight="Bold" Foreground="#F1F5F9" Margin="7,0,0,0" VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>

                <StackPanel Grid.Column="1" Margin="12,0,0,0" Orientation="Horizontal">
                    <Border Background="#1E40AF" CornerRadius="5" Padding="10,5" Margin="0,0,8,0" BorderBrush="#3B82F6" BorderThickness="1">
                        <TextBlock FontSize="12" Foreground="#F1F5F9" VerticalAlignment="Center">
                            <materialDesign:PackIcon Kind="Account" Width="14" Height="14" Foreground="#93C5FD"/>
                            <Run Text=" " FontSize="1"/>
                            <Run Text="{Binding NombreClienteActivo}" FontWeight="SemiBold"/>
                        </TextBlock>
                    </Border>

                    <Border Background="#1E40AF" CornerRadius="5" Padding="10,5" Margin="0,0,8,0" BorderBrush="#3B82F6" BorderThickness="1">
                        <TextBlock FontSize="12" Foreground="#F1F5F9" VerticalAlignment="Center">
                            <Run Text="DNI:" FontWeight="Medium" Foreground="#CBD5E1"/>
                            <Run Text="{Binding DniClienteActivo}" FontWeight="Bold"/>
                        </TextBlock>
                    </Border>

                    <Border Background="#1E40AF" CornerRadius="5" Padding="10,5" Margin="0,0,8,0" BorderBrush="#3B82F6" BorderThickness="1">
                        <TextBlock FontSize="12" Foreground="#F1F5F9" VerticalAlignment="Center">
                            <Run Text="Cuenta:" FontWeight="Medium" Foreground="#CBD5E1"/>
                            <Run Text="{Binding IdCuentaActiva}" FontWeight="Bold" Foreground="#60A5FA"/>
                        </TextBlock>
                    </Border>

                    <Border Background="#1E40AF" CornerRadius="5" Padding="10,5" BorderBrush="#3B82F6" BorderThickness="1">
                        <TextBlock FontSize="12" Foreground="#F1F5F9" VerticalAlignment="Center">
                            <Run Text="Hora:" FontWeight="Medium" Foreground="#CBD5E1"/>
                            <Run Text="{Binding CuentaSeleccionada.HoraIngreso}" FontWeight="Bold"/>
                        </TextBlock>
                    </Border>
                </StackPanel>

                <Button Grid.Column="2" 
                        Command="{Binding LimpiarCuentaActivaCommand}"
                        Style="{StaticResource MaterialDesignOutlinedButton}"
                        BorderBrush="#60A5FA"
                        Foreground="#F1F5F9"
                        Height="32"
                        Padding="12,0"
                        FontSize="11"
                        FontWeight="SemiBold">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="SwapHorizontal" Width="16" Height="16" VerticalAlignment="Center"/>
                        <TextBlock Text="Cambiar" Margin="8,0,0,0" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>
            </Grid>
        </Border>

        <!-- TabControl -->
        <TabControl Grid.Row="2" 
                    Style="{StaticResource MaterialDesignFilledTabControl}"
                    Background="#1A1D24">

            <!-- TAB: Gestión de Cuentas -->
            <TabItem>
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="Receipt" Width="15" Height="15" VerticalAlignment="Center"/>
                        <TextBlock Text="Gestión de Cuentas" Margin="7,0,0,0" VerticalAlignment="Center" FontSize="12"/>
                    </StackPanel>
                </TabItem.Header>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="300"/>
                        <ColumnDefinition Width="10"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Panel Izquierdo -->
                    <Border Grid.Column="0" Background="#1A1D24" CornerRadius="6" Padding="12">
                        <StackPanel>
                            <TextBlock Text="Nueva Cuenta" FontSize="14" FontWeight="SemiBold" Foreground="White" Margin="0,0,0,10"/>

                            <TextBlock Text="DNI Cliente" Foreground="#9CA3AF" FontSize="10" Margin="0,0,0,4" FontWeight="Medium"/>
                            <TextBox x:Name="TxtDni" 
                                     Text="{Binding DniBusqueda, UpdateSourceTrigger=PropertyChanged}" 
                                     materialDesign:HintAssist.Hint="8 dígitos"
                                     Padding="12,8"
                                     MaxLength="8"
                                     FontSize="13"
                                     Height="36"
                                     Margin="0,0,0,12"
                                     PreviewTextInput="TextBox_NumerosSoloPreviewTextInput"/>

                            <Button Command="{Binding BuscarClienteCommand}"
                                    Style="{StaticResource MaterialDesignRaisedButton}"
                                    Background="#4CC9F0"
                                    Foreground="#0F1115"
                                    Height="36"
                                    FontWeight="SemiBold"
                                    FontSize="12"
                                    Margin="0,0,0,10">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Magnify" Width="16" Height="16" VerticalAlignment="Center"/>
                                    <TextBlock Text="Buscar" Margin="7,0,0,0" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>

                            <Border Background="#4CC9F012" 
                                    BorderBrush="#4CC9F0"
                                    BorderThickness="1"
                                    CornerRadius="5" 
                                    Padding="10" 
                                    Margin="0,0,0,10"
                                    Visibility="{Binding ClienteEncontrado, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <StackPanel>
                                    <TextBlock Text="✓ ENCONTRADO" FontWeight="Bold" Foreground="#4CC9F0" FontSize="10" Margin="0,0,0,5"/>
                                    <TextBlock Text="{Binding NombreClienteBuscado}" FontSize="12" Foreground="White" TextWrapping="Wrap"/>
                                </StackPanel>
                            </Border>

                            <!-- 🎁 PANEL DE PROMOCIONES DISPONIBLES -->
                            <Border Background="#22C55E12" 
                                    BorderBrush="#22C55E"
                                    BorderThickness="1"
                                    CornerRadius="5" 
                                    Padding="10" 
                                    Margin="0,0,0,10"
                                    Visibility="{Binding InfoDescuentos.TieneDescuentos, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                        <materialDesign:PackIcon Kind="Gift" Width="14" Height="14" Foreground="#22C55E" VerticalAlignment="Center"/>
                                        <TextBlock Text="PROMOCIONES DISPONIBLES" FontWeight="Bold" Foreground="#22C55E" FontSize="10" Margin="5,0,0,0"/>
                                    </StackPanel>
                                    
                                    <TextBlock Text="{Binding InfoDescuentos.Mensaje}" 
                                               FontSize="11" 
                                               Foreground="#CBD5E1" 
                                               TextWrapping="Wrap"
                                               Margin="0,0,0,5"/>
                                    
                                    <ItemsControl ItemsSource="{Binding InfoDescuentos.DescuentosDisponibles}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal" Margin="0,2">
                                                    <materialDesign:PackIcon Kind="CheckCircle" 
                                                                           Width="12" Height="12" 
                                                                           Foreground="#22C55E" 
                                                                           VerticalAlignment="Center"/>
                                                    <TextBlock Text="{Binding}" 
                                                               Foreground="#22C55E" 
                                                               Margin="5,0" 
                                                               FontSize="10"/>
                                                </StackPanel>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                    
                                    <TextBlock Text="💰 Se aplicarán automáticamente al procesar el pago" 
                                               FontStyle="Italic" 
                                               FontSize="9" 
                                               Foreground="#9CA3AF"
                                               Margin="0,5,0,0"
                                               TextWrapping="Wrap"/>
                                </StackPanel>
                            </Border>

                            <Button Command="{Binding CrearCuentaCommand}"
                                    Style="{StaticResource MaterialDesignRaisedButton}"
                                    Background="#4CC9F0"
                                    Foreground="#0F1115"
                                    Height="36"
                                    FontWeight="SemiBold"
                                    FontSize="12"
                                    Margin="0,0,0,8"
                                    IsEnabled="{Binding ClienteEncontrado}">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Plus" Width="16" Height="16" VerticalAlignment="Center"/>
                                    <TextBlock Text="Crear Cuenta" Margin="7,0,0,0" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>

                            <Button Command="{Binding LimpiarBusquedaCommand}"
                                    Style="{StaticResource MaterialDesignOutlinedButton}"
                                    BorderBrush="#374151"
                                    Foreground="#9CA3AF"
                                    Height="36"
                                    FontSize="11"
                                    Margin="0,0,0,10">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Close" Width="14" Height="14" VerticalAlignment="Center"/>
                                    <TextBlock Text="Limpiar" Margin="5,0,0,0" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>

                            <ProgressBar IsIndeterminate="True" 
                                         Height="3"
                                         Margin="0,0,0,10"
                                         Visibility="{Binding EstaCargando, Converter={StaticResource BooleanToVisibilityConverter}}"/>

                            <Border Background="#1F2937" BorderBrush="#4CC9F0" BorderThickness="1" CornerRadius="5" Padding="10">
                                <StackPanel>
                                    <TextBlock Text="ℹ INFORMACIÓN" FontWeight="Bold" Foreground="#4CC9F0" FontSize="9" Margin="0,0,0,7"/>
                                    <TextBlock Foreground="#9CA3AF" FontSize="10" TextWrapping="Wrap" Margin="0,0,0,5">
                                        <Run Text="• Crear cuenta y luego ir a" FontWeight="Medium"/>
                                        <Run Text="'Consumos'" Foreground="#4CC9F0" FontWeight="Bold"/>
                                    </TextBlock>
                                    <TextBlock Foreground="#9CA3AF" FontSize="10" TextWrapping="Wrap">
                                        <Run Text="• Agregar productos/servicios" FontWeight="Medium"/>
                                    </TextBlock>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </Border>

                    <!-- Panel Derecho -->
                    <Border Grid.Column="2" Background="#1A1D24" CornerRadius="6" Padding="12">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <Grid Grid.Row="0" Margin="0,0,0,10">
                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                    <TextBlock Text="Cuentas Pendientes" FontSize="14" FontWeight="SemiBold" Foreground="White" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding CuentasPendientes.Count, StringFormat=' ({0})'}" 
                                               FontSize="12" FontWeight="Normal" Foreground="#9CA3AF" VerticalAlignment="Center"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                    <Button Command="{Binding AbrirModificarClienteCommand}"
                                            Style="{StaticResource MaterialDesignIconButton}"
                                            ToolTip="Modificar"
                                            Width="30" Height="30"
                                            Margin="0,0,5,0">
                                        <materialDesign:PackIcon Kind="AccountEdit" Width="16" Height="16" Foreground="#F59E0B"/>
                                    </Button>
                                    <Button Command="{Binding EliminarCuentaCommand}"
                                            Style="{StaticResource MaterialDesignIconButton}"
                                            ToolTip="Eliminar Cuenta"
                                            Width="30" Height="30"
                                            Margin="0,0,5,0">
                                        <materialDesign:PackIcon Kind="Delete" Width="16" Height="16" Foreground="#EF4444"/>
                                    </Button>
                                    <Button Command="{Binding ActualizarListaCommand}"
                                            Style="{StaticResource MaterialDesignIconButton}"
                                            ToolTip="Actualizar"
                                            Width="30" Height="30">
                                        <materialDesign:PackIcon Kind="Refresh" Width="16" Height="16" Foreground="#4CC9F0"/>
                                    </Button>
                                </StackPanel>
                            </Grid>

                            <!-- 🔍 FILTRO DE BÚSQUEDA DE CUENTAS -->
                            <Grid Grid.Row="1" Margin="0,0,0,10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBox Grid.Column="0"
                                         Text="{Binding FiltroCuentas, UpdateSourceTrigger=PropertyChanged}"
                                         materialDesign:HintAssist.Hint="Buscar por nombre, DNI o ID de cuenta..."
                                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                         FontSize="13"
                                         Height="36"
                                         Padding="12,8"
                                         Foreground="White"
                                         CaretBrush="#4CC9F0"
                                         BorderBrush="#374151"
                                         Margin="0,0,8,0">
                                    <TextBox.Resources>
                                        <Style TargetType="materialDesign:SmartHint" BasedOn="{StaticResource {x:Type materialDesign:SmartHint}}">
                                            <Setter Property="Foreground" Value="#6B7280"/>
                                        </Style>
                                    </TextBox.Resources>
                                </TextBox>
                                
                                <Button Grid.Column="1"
                                        Command="{Binding LimpiarFiltroCommand}"
                                        Style="{StaticResource MaterialDesignIconButton}"
                                        ToolTip="Limpiar filtro"
                                        Width="36" Height="36">
                                    <materialDesign:PackIcon Kind="FilterRemove" Width="16" Height="16" Foreground="#9CA3AF"/>
                                </Button>
                            </Grid>

                            <DataGrid Grid.Row="2"
                                      ItemsSource="{Binding CuentasPendientes}"
                                      SelectedItem="{Binding CuentaSeleccionada}"
                                      AutoGenerateColumns="False"
                                      IsReadOnly="True"
                                      SelectionMode="Single"
                                      CanUserAddRows="False"
                                      HeadersVisibility="Column"
                                      GridLinesVisibility="None"
                                      Background="Transparent"
                                      RowBackground="#1F2937"
                                      AlternatingRowBackground="#252A34"
                                      Foreground="White"
                                      FontSize="11"
                                      BorderThickness="0"
                                      SelectionChanged="DataGrid_SelectionChanged">
                                <DataGrid.ColumnHeaderStyle>
                                    <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource MaterialDesignDataGridColumnHeader}">
                                        <Setter Property="Background" Value="#1A1D24"/>
                                        <Setter Property="Foreground" Value="#9CA3AF"/>
                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                        <Setter Property="FontSize" Value="10"/>
                                        <Setter Property="Padding" Value="10,7"/>
                                        <Setter Property="BorderThickness" Value="0"/>
                                    </Style>
                                </DataGrid.ColumnHeaderStyle>
                                <DataGrid.CellStyle>
                                    <Style TargetType="DataGridCell" BasedOn="{StaticResource MaterialDesignDataGridCell}">
                                        <Setter Property="BorderThickness" Value="0"/>
                                        <Setter Property="Padding" Value="10,7"/>
                                    </Style>
                                </DataGrid.CellStyle>
                                <DataGrid.RowStyle>
                                    <Style TargetType="DataGridRow" BasedOn="{StaticResource MaterialDesignDataGridRow}">
                                        <Setter Property="Height" Value="36"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                                <Setter Property="Background" Value="#1E3A8A"/>
                                                <Setter Property="Foreground" Value="#F1F5F9"/>
                                                <Setter Property="FontWeight" Value="SemiBold"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </DataGrid.RowStyle>
                                <DataGrid.Columns>
                                    <DataGridTemplateColumn Header="◉" Width="45">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <RadioButton GroupName="CuentaSeleccion" 
                                                             IsChecked="{Binding IsSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                             Command="{Binding DataContext.SeleccionarCuentaCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                             CommandParameter="{Binding}"
                                                             HorizontalAlignment="Center"
                                                             VerticalAlignment="Center">
                                                    <RadioButton.Style>
                                                        <Style TargetType="RadioButton" BasedOn="{StaticResource MaterialDesignRadioButton}">
                                                            <Setter Property="Foreground" Value="#6B7280"/>
                                                            <Style.Triggers>
                                                                <Trigger Property="IsChecked" Value="True">
                                                                    <Setter Property="Foreground" Value="#60A5FA"/>
                                                                </Trigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </RadioButton.Style>
                                                </RadioButton>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTextColumn Header="ID" Binding="{Binding idCuenta}" Width="50"/>
                                    <DataGridTextColumn Header="Cliente" Binding="{Binding NombreCliente}" Width="*"/>
                                    <DataGridTextColumn Header="DNI" Binding="{Binding DocumentoCliente}" Width="85"/>
                                    <DataGridTextColumn Header="Hora" Binding="{Binding HoraIngreso}" Width="60"/>
                                    <DataGridTextColumn Header="Tiempo" Binding="{Binding TiempoTranscurrido}" Width="70"/>
                                    <DataGridTextColumn Header="Desc." Binding="{Binding descuento, StringFormat=S/. {0:0.00}}" Width="70"/>
                                    <DataGridTextColumn Header="Total" Binding="{Binding total, StringFormat=S/. {0:0.00}}" Width="80"/>
                                    <DataGridTextColumn Header="Estado" Binding="{Binding EstadoCuenta}" Width="85"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </Grid>
                    </Border>

                    <!-- Panel Modificar Cliente -->
                    <Border Grid.Column="2" 
                            Background="#0F1115E6" 
                            Visibility="{Binding MostrarPanelModificar, Converter={StaticResource BooleanToVisibilityConverter}}"
                            Panel.ZIndex="1000">
                        <Border Background="#1A1D24" 
                                BorderBrush="#4CC9F0" 
                                BorderThickness="2" 
                                CornerRadius="6"
                                MaxWidth="380"
                                Margin="60"
                                Padding="20"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center">
                            <StackPanel>
                                <TextBlock Text="Modificar Cliente" FontSize="15" FontWeight="Bold" Foreground="White" Margin="0,0,0,15"/>

                                <Border Background="#1F2937" BorderBrush="#374151" BorderThickness="1" CornerRadius="5" Padding="12" Margin="0,0,0,15">
                                    <StackPanel>
                                        <TextBlock Text="ACTUAL" FontSize="10" FontWeight="Bold" Foreground="#4CC9F0" Margin="0,0,0,7"/>
                                        <TextBlock FontSize="12" Foreground="#9CA3AF" Margin="0,0,0,4">
                                            <Run Text="{Binding CuentaSeleccionada.NombreCliente}" Foreground="White" FontWeight="SemiBold"/>
                                        </TextBlock>
                                        <TextBlock FontSize="12" Foreground="#9CA3AF">
                                            <Run Text="DNI:" FontWeight="Medium"/>
                                            <Run Text="{Binding CuentaSeleccionada.DocumentoCliente}" Foreground="White"/>
                                        </TextBlock>
                                    </StackPanel>
                                </Border>

                                <TextBlock Text="Nuevo DNI" Foreground="#9CA3AF" FontSize="11" Margin="0,0,0,7" FontWeight="Medium"/>
                                <TextBox x:Name="TxtNuevoDni"
                                         Text="{Binding NuevoDniModificar, UpdateSourceTrigger=PropertyChanged}"
                                         materialDesign:HintAssist.Hint="8 dígitos"
                                         MaxLength="8"
                                         FontSize="14"
                                         Height="40"
                                         Padding="12"
                                         Margin="0,0,0,15"
                                         PreviewTextInput="TextBox_NumerosSoloPreviewTextInput"/>

                                <Button Command="{Binding ConfirmarModificarClienteCommand}"
                                        Style="{StaticResource MaterialDesignRaisedButton}"
                                        Background="#F59E0B"
                                        Foreground="White"
                                        Height="40"
                                        FontSize="12"
                                        FontWeight="Bold"
                                        Margin="0,0,0,10">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="CheckCircle" Width="18" Height="18" VerticalAlignment="Center"/>
                                        <TextBlock Text="CONFIRMAR" Margin="10,0,0,0" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Button>

                                <Button Command="{Binding CerrarModificarClienteCommand}"
                                        Style="{StaticResource MaterialDesignOutlinedButton}"
                                        BorderBrush="#6B7280"
                                        Foreground="#9CA3AF"
                                        Height="40"
                                        FontSize="12">
                                    <TextBlock Text="Cancelar" VerticalAlignment="Center"/>
                                </Button>
                            </StackPanel>
                        </Border>
                    </Border>
                </Grid>
            </TabItem>

            <!-- TAB: Gestión de Consumos -->
            <TabItem>
                <TabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="CartOutline" Width="15" Height="15" VerticalAlignment="Center"/>
                        <TextBlock Text="Consumos" Margin="7,0,0,0" VerticalAlignment="Center" FontSize="12"/>
                    </StackPanel>
                </TabItem.Header>

                <Grid Margin="8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="10"/>
                        <ColumnDefinition Width="320"/>
                    </Grid.ColumnDefinitions>

                    <!-- PANEL PRINCIPAL -->
                    <Grid Grid.Column="0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="8"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- TabControl Productos/Servicios -->
                        <TabControl Grid.Row="0" 
                                    Style="{StaticResource MaterialDesignFilledTabControl}"
                                    Background="#1A1D24">

                            <!-- Tab Productos -->
                            <TabItem>
                                <TabItem.Header>
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="ShoppingOutline" Width="14" Height="14" VerticalAlignment="Center"/>
                                        <TextBlock Text="Productos" Margin="5,0,0,0" VerticalAlignment="Center" FontSize="11"/>
                                    </StackPanel>
                                </TabItem.Header>

                                <Grid Margin="10">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <TextBox Grid.Row="0"
                                             x:Name="TxtBuscarProducto"
                                             Text="{Binding BusquedaProducto, UpdateSourceTrigger=PropertyChanged}"
                                             materialDesign:HintAssist.Hint="🔍 Buscar..."
                                             Padding="12,8" 
                                             FontSize="13" 
                                             Height="36"
                                             Margin="0,0,0,10"/>

                                    <Border Grid.Row="1" Background="#14161C" CornerRadius="5" BorderBrush="#374151" BorderThickness="1">
                                        <ListBox ItemsSource="{Binding ProductosDisponibles}"
                                                 SelectedItem="{Binding ProductoSeleccionado}"
                                                 Background="Transparent" 
                                                 BorderThickness="0">
                                            <ListBox.ItemContainerStyle>
                                                <Style TargetType="ListBoxItem" BasedOn="{StaticResource MaterialDesignListBoxItem}">
                                                    <Setter Property="Padding" Value="0"/>
                                                    <Setter Property="Margin" Value="0"/>
                                                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                                    <Style.Triggers>
                                                        <Trigger Property="IsSelected" Value="True">
                                                            <Setter Property="Background" Value="#4CC9F018"/>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </ListBox.ItemContainerStyle>
                                            <ListBox.ItemTemplate>
                                                <DataTemplate>
                                                    <Border Padding="10,7" BorderBrush="#374151" BorderThickness="0,0,0,0.5">
                                                        <Grid>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="75"/>
                                                                <ColumnDefinition Width="55"/>
                                                            </Grid.ColumnDefinitions>

                                                            <TextBlock Grid.Column="0" 
                                                                       Text="{Binding nombre}" 
                                                                       FontSize="11" 
                                                                       FontWeight="SemiBold" 
                                                                       Foreground="White"
                                                                       VerticalAlignment="Center"
                                                                       TextTrimming="CharacterEllipsis"/>

                                                            <TextBlock Grid.Column="1" 
                                                                       FontSize="11" 
                                                                       FontWeight="SemiBold" 
                                                                       Foreground="#22C55E"
                                                                       TextAlignment="Center"
                                                                       VerticalAlignment="Center">
                                                                <Run Text="S/. "/>
                                                                <Run Text="{Binding precioVenta, StringFormat={}{0:0.00}}"/>
                                                            </TextBlock>

                                                            <Border Grid.Column="2" 
                                                                    Background="#22C55E18"
                                                                    CornerRadius="4" 
                                                                    Padding="7,3"
                                                                    HorizontalAlignment="Center">
                                                                <TextBlock Text="{Binding stockActual}" 
                                                                           FontSize="10" 
                                                                           FontWeight="Bold" 
                                                                           Foreground="#22C55E"
                                                                           TextAlignment="Center"/>
                                                            </Border>
                                                        </Grid>
                                                    </Border>
                                                </DataTemplate>
                                            </ListBox.ItemTemplate>
                                        </ListBox>
                                    </Border>

                                    <Border Grid.Row="2" Background="#1A1D24" CornerRadius="5" Padding="10" Margin="0,10,0,0">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="8"/>
                                                <ColumnDefinition Width="80"/>
                                                <ColumnDefinition Width="10"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>

                                            <TextBlock Grid.Column="0" 
                                                       Text="Cant:" 
                                                       FontSize="12" 
                                                       Foreground="#9CA3AF" 
                                                       VerticalAlignment="Center"/>

                                            <Border Grid.Column="2" 
                                                    Background="#0F1115" 
                                                    BorderBrush="#4CC9F0" 
                                                    BorderThickness="2"
                                                    CornerRadius="5">
                                                <TextBox x:Name="TxtCantidadProducto" 
                                                         Text="{Binding CantidadProducto, UpdateSourceTrigger=PropertyChanged}" 
                                                         TextAlignment="Center" 
                                                         FontSize="20"
                                                         FontWeight="ExtraBold"
                                                         Foreground="#4CC9F0"
                                                         Background="Transparent"
                                                         BorderThickness="0"
                                                         Height="38" 
                                                         VerticalContentAlignment="Center"
                                                         PreviewTextInput="TextBox_NumerosSoloPreviewTextInput"
                                                         Padding="0"/>
                                            </Border>

                                            <Button Grid.Column="4" 
                                                    Command="{Binding AgregarProductoACuentaCommand}"
                                                    Style="{StaticResource MaterialDesignRaisedButton}" 
                                                    Height="38" 
                                                    FontWeight="SemiBold" 
                                                    FontSize="11"
                                                    Background="#06B6D4"
                                                    Foreground="White">
                                                <StackPanel Orientation="Horizontal">
                                                    <materialDesign:PackIcon Kind="Plus" Width="16" Height="16" VerticalAlignment="Center"/>
                                                    <TextBlock Text="AGREGAR" Margin="7,0,0,0" VerticalAlignment="Center"/>
                                                </StackPanel>
                                            </Button>
                                        </Grid>
                                    </Border>
                                </Grid>
                            </TabItem>

                            <!-- Tab Servicios -->
                            <TabItem>
                                <TabItem.Header>
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Spa" Width="14" Height="14" VerticalAlignment="Center"/>
                                        <TextBlock Text="Servicios" Margin="5,0,0,0" VerticalAlignment="Center" FontSize="11"/>
                                    </StackPanel>
                                </TabItem.Header>

                                <Grid Margin="10">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <TextBox Grid.Row="0"
                                             x:Name="TxtBuscarServicio"
                                             Text="{Binding BusquedaServicio, UpdateSourceTrigger=PropertyChanged}"
                                             materialDesign:HintAssist.Hint="🔍 Buscar..."
                                             Padding="12,8" 
                                             FontSize="13" 
                                             Height="36"
                                             Margin="0,0,0,10"/>

                                    <Border Grid.Row="1" Background="#14161C" CornerRadius="5" BorderBrush="#374151" BorderThickness="1">
                                        <ListBox ItemsSource="{Binding ServiciosDisponibles}"
                                                 SelectedItem="{Binding ServicioSeleccionado}"
                                                 Background="Transparent" 
                                                 BorderThickness="0">
                                            <ListBox.ItemContainerStyle>
                                                <Style TargetType="ListBoxItem" BasedOn="{StaticResource MaterialDesignListBoxItem}">
                                                    <Setter Property="Padding" Value="0"/>
                                                    <Setter Property="Margin" Value="0"/>
                                                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                                    <Style.Triggers>
                                                        <Trigger Property="IsSelected" Value="True">
                                                            <Setter Property="Background" Value="#4CC9F018"/>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </ListBox.ItemContainerStyle>
                                            <ListBox.ItemTemplate>
                                                <DataTemplate>
                                                    <Border Padding="10,7" BorderBrush="#374151" BorderThickness="0,0,0,0.5">
                                                        <Grid>
                                                            <TextBlock Text="{Binding nombre}" 
                                                                       FontSize="11" 
                                                                       FontWeight="SemiBold" 
                                                                       Foreground="White"
                                                                       VerticalAlignment="Center"/>

                                                            <TextBlock FontSize="11" 
                                                                       FontWeight="Bold" 
                                                                       Foreground="#22C55E"
                                                                       HorizontalAlignment="Right"
                                                                       VerticalAlignment="Center">
                                                                <Run Text="S/. "/>
                                                                <Run Text="{Binding precio, StringFormat={}{0:0.00}}"/>
                                                            </TextBlock>
                                                        </Grid>
                                                    </Border>
                                                </DataTemplate>
                                            </ListBox.ItemTemplate>
                                        </ListBox>
                                    </Border>

                                    <Border Grid.Row="2" Background="#1A1D24" CornerRadius="5" Padding="10" Margin="0,10,0,0">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="8"/>
                                                <ColumnDefinition Width="80"/>
                                                <ColumnDefinition Width="10"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>

                                            <TextBlock Grid.Column="0" 
                                                       Text="Cant:" 
                                                       FontSize="12" 
                                                       Foreground="#9CA3AF" 
                                                       VerticalAlignment="Center"/>

                                            <Border Grid.Column="2" 
                                                    Background="#0F1115" 
                                                    BorderBrush="#4CC9F0" 
                                                    BorderThickness="2"
                                                    CornerRadius="5">
                                                <TextBox x:Name="TxtCantidadServicio" 
                                                         Text="{Binding CantidadServicio, UpdateSourceTrigger=PropertyChanged}" 
                                                         TextAlignment="Center" 
                                                         FontSize="20"
                                                         FontWeight="ExtraBold"
                                                         Foreground="#4CC9F0"
                                                         Background="Transparent"
                                                         BorderThickness="0"
                                                         Height="38" 
                                                         VerticalContentAlignment="Center"
                                                         PreviewTextInput="TextBox_NumerosSoloPreviewTextInput"
                                                         Padding="0"/>
                                            </Border>

                                            <Button Grid.Column="4"
                                                    Command="{Binding AgregarServicioACuentaCommand}"
                                                    Style="{StaticResource MaterialDesignRaisedButton}" 
                                                    Height="38" 
                                                    FontWeight="SemiBold" 
                                                    FontSize="11"
                                                    Background="#06B6D4"
                                                    Foreground="White">
                                                <StackPanel Orientation="Horizontal">
                                                    <materialDesign:PackIcon Kind="Plus" Width="16" Height="16" VerticalAlignment="Center"/>
                                                    <TextBlock Text="AGREGAR" Margin="7,0,0,0" VerticalAlignment="Center"/>
                                                </StackPanel>
                                            </Button>
                                        </Grid>
                                    </Border>
                                </Grid>
                            </TabItem>
                        </TabControl>

                        <!-- SECCIÓN: Consumos + Devolución -->
                        <StackPanel Grid.Row="2">
                            <!-- Tabla Consumos -->
                            <Border Background="#1A1D24" CornerRadius="5" BorderBrush="#374151" BorderThickness="1" Margin="0,0,0,8">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="165"/>
                                    </Grid.RowDefinitions>

                                    <Border Grid.Row="0" Background="#14161C" Padding="10,6" BorderBrush="#374151" BorderThickness="0,0,0,1">
                                        <Grid>
                                            <TextBlock Text="CONSUMOS ACTUALES" FontSize="11" FontWeight="Bold" Foreground="#9CA3AF" VerticalAlignment="Center"/>
                                            <Border Background="#4CC9F018" CornerRadius="10" Padding="8,3" HorizontalAlignment="Right">
                                                <TextBlock FontSize="10" FontWeight="Bold" Foreground="#4CC9F0">
                                                    <Run Text="{Binding TotalItemsCuenta}"/>
                                                    <Run Text=" items"/>
                                                </TextBlock>
                                            </Border>
                                        </Grid>
                                    </Border>

                                    <DataGrid Grid.Row="1" 
                                              x:Name="DataGridConsumos"
                                              ItemsSource="{Binding ConsumosCuentaActual}"
                                              SelectedItem="{Binding ConsumoSeleccionado}"
                                              AutoGenerateColumns="False" 
                                              IsReadOnly="True" 
                                              CanUserAddRows="False" 
                                              HeadersVisibility="Column" 
                                              GridLinesVisibility="None" 
                                              Background="Transparent" 
                                              RowBackground="#1F2937" 
                                              Foreground="White" 
                                              FontSize="10" 
                                              BorderThickness="0">
                                        <DataGrid.ColumnHeaderStyle>
                                            <Style TargetType="DataGridColumnHeader">
                                                <Setter Property="Background" Value="Transparent"/>
                                                <Setter Property="Foreground" Value="#9CA3AF"/>
                                                <Setter Property="FontWeight" Value="SemiBold"/>
                                                <Setter Property="FontSize" Value="9"/>
                                                <Setter Property="Padding" Value="7,5"/>
                                            </Style>
                                        </DataGrid.ColumnHeaderStyle>
                                        <DataGrid.CellStyle>
                                            <Style TargetType="DataGridCell">
                                                <Setter Property="BorderThickness" Value="0"/>
                                                <Setter Property="Padding" Value="7,5"/>
                                            </Style>
                                        </DataGrid.CellStyle>
                                        <DataGrid.RowStyle>
                                            <Style TargetType="DataGridRow">
                                                <Setter Property="Height" Value="32"/>
                                            </Style>
                                        </DataGrid.RowStyle>
                                        <DataGrid.Columns>
                                            <DataGridTemplateColumn Header="Tipo" Width="52">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <Border Background="{Binding TipoColor}" 
                                                                CornerRadius="3" 
                                                                Padding="5,2"
                                                                HorizontalAlignment="Center">
                                                            <TextBlock Text="{Binding Tipo}" 
                                                                       FontSize="8" 
                                                                       FontWeight="Bold" 
                                                                       Foreground="White"/>
                                                        </Border>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <DataGridTextColumn Header="Item" Binding="{Binding NombreItem}" Width="*"/>
                                            <DataGridTextColumn Header="Cant" Binding="{Binding cantidad}" Width="42"/>
                                            <DataGridTextColumn Header="P.U." Binding="{Binding precioUnitario, StringFormat=S/. {0:0.00}}" Width="65"/>
                                            <DataGridTextColumn Header="Total" Binding="{Binding subtotal, StringFormat=S/. {0:0.00}}" Width="70"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </Grid>
                            </Border>

                            <!-- Botón Devolución -->
                            <Button x:Name="BtnToggleDevolucion"
                                    Style="{StaticResource MaterialDesignOutlinedButton}"
                                    BorderBrush="#F59E0B"
                                    Background="#F59E0B18"
                                    Foreground="#F59E0B"
                                    Height="36"
                                    FontWeight="SemiBold"
                                    FontSize="11"
                                    Margin="0,0,0,8"
                                    Click="BtnToggleDevolucion_Click">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Undo" Width="16" Height="16" VerticalAlignment="Center"/>
                                    <TextBlock Text="DEVOLUCIÓN" Margin="8,0,8,0" VerticalAlignment="Center"/>
                                    <materialDesign:PackIcon x:Name="IconDevolucionArrow" Kind="ChevronDown" Width="16" Height="16" VerticalAlignment="Center">
                                        <materialDesign:PackIcon.RenderTransform>
                                            <RotateTransform Angle="0"/>
                                        </materialDesign:PackIcon.RenderTransform>
                                    </materialDesign:PackIcon>
                                </StackPanel>
                            </Button>

                            <!-- Panel Devolución BALANCEADO -->
                            <Border x:Name="DevolucionPanel" 
                                    Background="#1A1D24" 
                                    CornerRadius="5" 
                                    BorderBrush="#F59E0B" 
                                    BorderThickness="1"
                                    Height="0"
                                    ClipToBounds="True">
                                <Grid Margin="12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="1.2*"/>
                                        <ColumnDefinition Width="8"/>
                                        <ColumnDefinition Width="110"/>
                                        <ColumnDefinition Width="8"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="8"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Info Producto -->
                                    <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                        <TextBlock Text="Producto seleccionado:" FontSize="9" Foreground="#9CA3AF" Margin="0,0,0,3"/>
                                        <TextBlock Text="{Binding ConsumoSeleccionado.NombreItem}" 
                                                   FontSize="11" 
                                                   FontWeight="Bold" 
                                                   Foreground="White" 
                                                   TextWrapping="Wrap"
                                                   MaxHeight="35"
                                                   TextTrimming="CharacterEllipsis"/>
                                        <Grid Margin="0,4,0,0">
                                            <TextBlock FontSize="10" Foreground="#9CA3AF">
                                                <Run Text="En cuenta:"/>
                                                <Run Text="{Binding ConsumoSeleccionado.cantidad}" Foreground="#4CC9F0" FontWeight="Bold"/>
                                            </TextBlock>
                                            <TextBlock FontSize="10" Foreground="#9CA3AF" HorizontalAlignment="Right">
                                                <Run Text="P.U:"/>
                                                <Run Text="{Binding ConsumoSeleccionado.precioUnitario, StringFormat=S/. {0:0.00}}" Foreground="#4CC9F0" FontWeight="Bold"/>
                                            </TextBlock>
                                        </Grid>
                                    </StackPanel>

                                    <!-- Input Cantidad -->
                                    <Border Grid.Column="2" 
                                            Background="#0F1115" 
                                            BorderBrush="#F59E0B" 
                                            BorderThickness="2"
                                            CornerRadius="5"
                                            VerticalAlignment="Center">
                                        <StackPanel>
                                            <TextBlock Text="Cantidad" FontSize="9" Foreground="#9CA3AF" TextAlignment="Center" Margin="0,3,0,0"/>
                                            <TextBox x:Name="TxtCantidadDevolver"
                                                     Text="{Binding CantidadADevolver, UpdateSourceTrigger=PropertyChanged}"
                                                     TextAlignment="Center" 
                                                     FontSize="22"
                                                     FontWeight="ExtraBold"
                                                     Foreground="#F59E0B"
                                                     Background="Transparent"
                                                     BorderThickness="0"
                                                     Height="45"
                                                     VerticalContentAlignment="Center"
                                                     PreviewTextInput="TextBox_NumerosSoloPreviewTextInput"
                                                     MaxLength="3"
                                                     Padding="0"/>
                                        </StackPanel>
                                    </Border>

                                    <!-- Botón Devolver -->
                                    <Button Grid.Column="4"
                                            Command="{Binding DevolverProductoCommand}"
                                            Style="{StaticResource MaterialDesignRaisedButton}"
                                            Background="#F59E0B"
                                            Foreground="White"
                                            Height="55"
                                            FontSize="10"
                                            FontWeight="Bold"
                                            VerticalAlignment="Center"
                                            IsEnabled="{Binding ConsumoSeleccionado, Converter={StaticResource NullToVisibilityConverter}}">
                                        <StackPanel>
                                            <materialDesign:PackIcon Kind="Undo" Width="18" Height="18" HorizontalAlignment="Center"/>
                                            <TextBlock Text="DEVOLVER" Margin="0,3,0,0" TextAlignment="Center"/>
                                        </StackPanel>
                                    </Button>

                                    <!-- Botón Eliminar -->
                                    <Button Grid.Column="6"
                                            Command="{Binding EliminarConsumoCommand}"
                                            CommandParameter="{Binding ConsumoSeleccionado}"
                                            Style="{StaticResource MaterialDesignOutlinedButton}"
                                            BorderBrush="#EF4444"
                                            Foreground="#EF4444"
                                            Height="55"
                                            FontSize="10"
                                            VerticalAlignment="Center"
                                            IsEnabled="{Binding ConsumoSeleccionado, Converter={StaticResource NullToVisibilityConverter}}">
                                        <StackPanel>
                                            <materialDesign:PackIcon Kind="Delete" Width="18" Height="18" HorizontalAlignment="Center"/>
                                            <TextBlock Text="ELIMINAR" Margin="0,3,0,0" TextAlignment="Center"/>
                                        </StackPanel>
                                    </Button>
                                </Grid>
                            </Border>
                        </StackPanel>
                    </Grid>

                    <!-- PANEL DERECHO: Resumen -->
                    <Border Grid.Column="2" Background="#1A1D24" CornerRadius="6" Padding="12">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Text="Resumen" FontSize="14" FontWeight="SemiBold" Foreground="White" Margin="0,0,0,10"/>

                            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                                <StackPanel>
                                    <Border Background="#06B6D418" BorderBrush="#06B6D4" BorderThickness="1" CornerRadius="5" Padding="10" Margin="0,0,0,10">
                                        <StackPanel>
                                            <TextBlock Text="CLIENTE" FontSize="9" FontWeight="Bold" Foreground="#06B6D4" Margin="0,0,0,7"/>
                                            <TextBlock FontSize="11" Foreground="White" FontWeight="SemiBold" Margin="0,0,0,3" TextWrapping="Wrap">
                                                <Run Text="{Binding CuentaSeleccionada.NombreCliente}"/>
                                            </TextBlock>
                                            <TextBlock FontSize="10" Foreground="#9CA3AF">
                                                <Run Text="DNI:"/>
                                                <Run Text="{Binding CuentaSeleccionada.DocumentoCliente}" Foreground="White"/>
                                            </TextBlock>
                                        </StackPanel>
                                    </Border>

                                    <TextBlock Text="CONSUMOS" FontSize="9" FontWeight="Bold" Foreground="#A855F7" Margin="0,0,0,7"/>
                                    <Grid Margin="0,0,0,4">
                                        <TextBlock Text="Productos:" FontSize="11" Foreground="#9CA3AF"/>
                                        <TextBlock HorizontalAlignment="Right" FontSize="11" Foreground="#4CC9F0" FontWeight="Bold">
                                            <Run Text="{Binding CantidadProductos}"/>
                                            <Run Text=" items" FontSize="9"/>
                                        </TextBlock>
                                    </Grid>
                                    <Grid Margin="0,0,0,10">
                                        <TextBlock Text="Servicios:" FontSize="11" Foreground="#9CA3AF"/>
                                        <TextBlock HorizontalAlignment="Right" FontSize="11" Foreground="#4CC9F0" FontWeight="Bold">
                                            <Run Text="{Binding CantidadServicios}"/>
                                            <Run Text=" items" FontSize="9"/>
                                        </TextBlock>
                                    </Grid>

                                    <TextBlock Text="COBRO" FontSize="9" FontWeight="Bold" Foreground="#A855F7" Margin="0,0,0,7"/>
                                    <Grid Margin="0,0,0,4">
                                        <TextBlock Text="Productos:" FontSize="11" Foreground="#9CA3AF"/>
                                        <TextBlock Text="{Binding TotalProductos, StringFormat=S/. {0:0.00}}" FontSize="11" Foreground="#22C55E" FontWeight="SemiBold" HorizontalAlignment="Right"/>
                                    </Grid>
                                    <Grid Margin="0,0,0,10">
                                        <TextBlock Text="Servicios:" FontSize="11" Foreground="#9CA3AF"/>
                                        <TextBlock Text="{Binding TotalServicios, StringFormat=S/. {0:0.00}}" FontSize="11" Foreground="#22C55E" FontWeight="SemiBold" HorizontalAlignment="Right"/>
                                    </Grid>

                                    <!-- 🎁 MOSTRAR DESCUENTO APLICADO -->
                                    <Grid Margin="0,0,0,10" Visibility="{Binding CuentaSeleccionada.descuento, Converter={StaticResource GreaterThanZeroConverter}}">
                                        <TextBlock Text="Descuento:" FontSize="11" Foreground="#F59E0B"/>
                                        <TextBlock Text="{Binding CuentaSeleccionada.descuento, StringFormat=-S/. {0:0.00}}" FontSize="11" Foreground="#F59E0B" FontWeight="SemiBold" HorizontalAlignment="Right"/>
                                    </Grid>

                                    <Border Height="1.5" Background="#374151" Margin="0,5" CornerRadius="0.5"/>

                                    <Border Background="#7C3AED" CornerRadius="5" Padding="12" Margin="0,5,0,0">
                                        <Grid>
                                            <TextBlock Text="TOTAL:" FontSize="12" FontWeight="Bold" Foreground="White" VerticalAlignment="Center"/>
                                            <TextBlock Text="{Binding TotalCuenta, StringFormat=S/. {0:0.00}}" FontSize="22" FontWeight="ExtraBold" Foreground="White" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                                        </Grid>
                                    </Border>
                                </StackPanel>
                            </ScrollViewer>

                            <Border Grid.Row="2" Background="#22C55E18" BorderBrush="#22C55E" BorderThickness="1" CornerRadius="5" Padding="10" Margin="0,10,0,10">
                                <Grid>
                                    <TextBlock Text="Tiempo:" FontSize="11" Foreground="#9CA3AF" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding CuentaSeleccionada.TiempoTranscurrido}" FontSize="18" FontWeight="ExtraBold" Foreground="#22C55E" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                                </Grid>
                            </Border>

                            <Button Grid.Row="3"
                                    Command="{Binding CerrarCuentaCommand}"
                                    Style="{StaticResource MaterialDesignRaisedButton}"
                                    Background="#22C55E"
                                    Foreground="White"
                                    Height="45"
                                    FontWeight="Bold"
                                    FontSize="12">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="CashMultiple" Width="20" Height="20" VerticalAlignment="Center"/>
                                    <TextBlock Text="IR A PAGO" Margin="10,0,0,0" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                        </Grid>
                    </Border>
                </Grid>
            </TabItem>
        </TabControl>
    </Grid>
</UserControl>