<UserControl x:Class="ProyectoSauna.UserControlCuentas"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:vm="clr-namespace:ProyectoSauna.ViewModels"
             Background="#0F1115">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>

        <Style TargetType="TextBox" BasedOn="{StaticResource MaterialDesignOutlinedTextBox}">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="CaretBrush" Value="#4CC9F0"/>
            <Setter Property="BorderBrush" Value="#374151"/>
        </Style>
    </UserControl.Resources>

    <UserControl.DataContext>
        <vm:CuentasViewModel/>
    </UserControl.DataContext>

    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Encabezado Ultra Compacto -->
        <Border Grid.Row="0" Background="#1A1D24" CornerRadius="6" Padding="12,8" Margin="0,0,0,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <materialDesign:PackIcon Grid.Column="0" Kind="Receipt" Width="22" Height="22" Foreground="#4CC9F0" VerticalAlignment="Center"/>
                <StackPanel Grid.Column="1" Margin="10,0,0,0" VerticalAlignment="Center">
                    <TextBlock Text="Cuentas y Consumos" FontSize="16" FontWeight="SemiBold" Foreground="White"/>
                    <TextBlock Text="Gestión centralizada" FontSize="10" Foreground="#6B7280" Margin="0,1,0,0"/>
                </StackPanel>

                <Border Grid.Column="2" Background="#4CC9F018" CornerRadius="4" Padding="10,4">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="ClockOutline" Width="14" Height="14" Foreground="#4CC9F0" VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding CuentasPendientes.Count, StringFormat='{}{0} pendientes'}" 
                                   Foreground="#4CC9F0" FontSize="11" FontWeight="Medium" Margin="5,0,0,0" VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <!-- Contenido Principal -->
        <TabControl Grid.Row="1" 
                    Style="{StaticResource MaterialDesignFilledTabControl}"
                    Background="#1A1D24"
                    materialDesign:ColorZoneAssist.Mode="PrimaryMid">

            <!-- TAB 1: GESTIÓN DE CUENTAS -->
            <TabItem>
                <TabItem.HeaderTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Receipt" Width="16" Height="16" VerticalAlignment="Center"/>
                            <TextBlock Text="Gestión de Cuentas" Margin="6,0,0,0" VerticalAlignment="Center" FontSize="12"/>
                        </StackPanel>
                    </DataTemplate>
                </TabItem.HeaderTemplate>

                <Grid Margin="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="340"/>
                        <ColumnDefinition Width="10"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- PANEL IZQUIERDO: Formulario Compacto -->
                    <Border Grid.Column="0" Background="#1A1D24" CornerRadius="6" Padding="14">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel>
                                <!-- Título -->
                                <Grid Margin="0,0,0,12">
                                    <materialDesign:PackIcon Kind="AccountPlus" Width="16" Height="16" Foreground="#4CC9F0" VerticalAlignment="Center" HorizontalAlignment="Left"/>
                                    <TextBlock Text="Nueva Cuenta" FontSize="14" FontWeight="SemiBold" Foreground="White" Margin="22,0,0,0" VerticalAlignment="Center"/>
                                </Grid>

                                <!-- DNI Compacto -->
                                <StackPanel Margin="0,0,0,8">
                                    <TextBlock Text="DNI del Cliente *" Foreground="#9CA3AF" FontSize="10" Margin="0,0,0,3" FontWeight="Medium"/>
                                    <TextBox x:Name="TxtDni" 
                                             Text="{Binding DniBusqueda, UpdateSourceTrigger=PropertyChanged}" 
                                             materialDesign:HintAssist.Hint="8 dígitos"
                                             materialDesign:HintAssist.Foreground="#6B7280"
                                             Padding="10,8"
                                             MaxLength="8"
                                             FontSize="14"
                                             Height="36"
                                             PreviewTextInput="TextBox_NumerosSoloPreviewTextInput"/>
                                </StackPanel>

                                <Button Command="{Binding BuscarClienteCommand}"
                                        Style="{StaticResource MaterialDesignRaisedButton}"
                                        Background="#4CC9F0"
                                        Foreground="#0F1115"
                                        Height="34"
                                        FontWeight="SemiBold"
                                        FontSize="12"
                                        Margin="0,6,0,12">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Magnify" Width="15" Height="15" VerticalAlignment="Center"/>
                                        <TextBlock Text="Buscar Cliente" Margin="5,0,0,0" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Button>

                                <!-- Info Cliente -->
                                <Border Background="#4CC9F012" 
                                        BorderBrush="#4CC9F0"
                                        BorderThickness="1"
                                        CornerRadius="5" 
                                        Padding="10" 
                                        Margin="0,0,0,12"
                                        Visibility="{Binding ClienteEncontrado, Converter={StaticResource BooleanToVisibilityConverter}}">
                                    <StackPanel>
                                        <Grid Margin="0,0,0,6">
                                            <materialDesign:PackIcon Kind="CheckCircle" Width="14" Height="14" Foreground="#4CC9F0" VerticalAlignment="Center" HorizontalAlignment="Left"/>
                                            <TextBlock Text="CLIENTE ENCONTRADO" FontWeight="Bold" Foreground="#4CC9F0" FontSize="9" Margin="18,0,0,0" VerticalAlignment="Center"/>
                                        </Grid>
                                        <TextBlock Text="{Binding NombreClienteBuscado}" FontSize="13" Foreground="White" TextWrapping="Wrap"/>
                                    </StackPanel>
                                </Border>

                                <!-- Botones Compactos -->
                                <Button Command="{Binding CrearCuentaCommand}"
                                        Style="{StaticResource MaterialDesignRaisedButton}"
                                        Background="#4CC9F0"
                                        Foreground="#0F1115"
                                        Height="34"
                                        FontWeight="SemiBold"
                                        FontSize="12"
                                        Margin="0,0,0,6"
                                        IsEnabled="{Binding ClienteEncontrado}">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Plus" Width="15" Height="15" VerticalAlignment="Center"/>
                                        <TextBlock Text="Crear Cuenta" Margin="5,0,0,0" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Button>

                                <Button Command="{Binding LimpiarBusquedaCommand}"
                                        Style="{StaticResource MaterialDesignOutlinedButton}"
                                        BorderBrush="#374151"
                                        Foreground="#9CA3AF"
                                        Height="34"
                                        FontWeight="Medium"
                                        FontSize="12"
                                        Margin="0,0,0,12">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Close" Width="14" Height="14" VerticalAlignment="Center"/>
                                        <TextBlock Text="Limpiar" Margin="4,0,0,0" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Button>

                                <ProgressBar IsIndeterminate="True" 
                                             Height="2"
                                             Margin="0,6,0,12"
                                             Visibility="{Binding EstaCargando, Converter={StaticResource BooleanToVisibilityConverter}}"/>

                                <!-- Info Promociones Compacta -->
                                <Border Background="#1F2937" 
                                        BorderBrush="#4CC9F0"
                                        BorderThickness="1"
                                        CornerRadius="5" 
                                        Padding="10">
                                    <StackPanel>
                                        <Grid Margin="0,0,0,6">
                                            <materialDesign:PackIcon Kind="TagMultiple" Width="14" Height="14" Foreground="#4CC9F0" VerticalAlignment="Center" HorizontalAlignment="Left"/>
                                            <TextBlock Text="PROGRAMA DE FIDELIZACIÓN" FontWeight="Bold" Foreground="#4CC9F0" FontSize="9" Margin="18,0,0,0" VerticalAlignment="Center"/>
                                        </Grid>

                                        <TextBlock Foreground="#9CA3AF" FontSize="9" TextWrapping="Wrap" Margin="0,0,0,4">
                                            <Run Text="• Precio normal:" FontWeight="Medium"/>
                                            <Run Text="S/. 20.00" Foreground="White"/>
                                        </TextBlock>

                                        <TextBlock Foreground="#9CA3AF" FontSize="9" TextWrapping="Wrap" Margin="0,0,0,4">
                                            <Run Text="• 5ta visita:" FontWeight="Medium"/>
                                            <Run Text="DESCUENTO 🎉" Foreground="#4CC9F0" FontWeight="Bold"/>
                                        </TextBlock>

                                        <TextBlock Foreground="#9CA3AF" FontSize="9" TextWrapping="Wrap">
                                            <Run Text="• Aplica cada 5 visitas" FontWeight="Medium" Foreground="White"/>
                                        </TextBlock>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </ScrollViewer>
                    </Border>

                    <!-- PANEL DERECHO: Lista Cuentas -->
                    <Border Grid.Column="2" Background="#1A1D24" CornerRadius="6" Padding="14">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <!-- Título -->
                            <Grid Grid.Row="0" Margin="0,0,0,10">
                                <materialDesign:PackIcon Kind="ClipboardList" Width="16" Height="16" Foreground="#4CC9F0" VerticalAlignment="Center" HorizontalAlignment="Left"/>
                                <TextBlock Text="Cuentas Pendientes" FontSize="14" FontWeight="SemiBold" Foreground="White" Margin="22,0,0,0" VerticalAlignment="Center"/>

                                <Button Command="{Binding ActualizarListaCommand}"
                                        Style="{StaticResource MaterialDesignIconButton}"
                                        HorizontalAlignment="Right"
                                        ToolTip="Actualizar"
                                        Width="28" Height="28">
                                    <materialDesign:PackIcon Kind="Refresh" Width="16" Height="16" Foreground="#4CC9F0"/>
                                </Button>
                            </Grid>

                            <!-- DataGrid Optimizado -->
                            <DataGrid Grid.Row="1"
                                      ItemsSource="{Binding CuentasPendientes}"
                                      SelectedItem="{Binding CuentaSeleccionada}"
                                      AutoGenerateColumns="False"
                                      IsReadOnly="True"
                                      SelectionMode="Single"
                                      CanUserAddRows="False"
                                      HeadersVisibility="Column"
                                      GridLinesVisibility="None"
                                      Background="Transparent"
                                      RowBackground="#1F2937"
                                      AlternatingRowBackground="#252A34"
                                      Foreground="White"
                                      FontSize="11"
                                      BorderThickness="0"
                                      SelectionChanged="DataGrid_SelectionChanged">
                                <DataGrid.ColumnHeaderStyle>
                                    <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource MaterialDesignDataGridColumnHeader}">
                                        <Setter Property="Background" Value="#1A1D24"/>
                                        <Setter Property="Foreground" Value="#9CA3AF"/>
                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                        <Setter Property="FontSize" Value="10"/>
                                        <Setter Property="Padding" Value="10,6"/>
                                        <Setter Property="BorderThickness" Value="0"/>
                                    </Style>
                                </DataGrid.ColumnHeaderStyle>
                                <DataGrid.CellStyle>
                                    <Style TargetType="DataGridCell" BasedOn="{StaticResource MaterialDesignDataGridCell}">
                                        <Setter Property="BorderThickness" Value="0"/>
                                        <Setter Property="Padding" Value="10,8"/>
                                    </Style>
                                </DataGrid.CellStyle>
                                <DataGrid.RowStyle>
                                    <Style TargetType="DataGridRow" BasedOn="{StaticResource MaterialDesignDataGridRow}">
                                        <Setter Property="Height" Value="36"/>
                                    </Style>
                                </DataGrid.RowStyle>
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="ID" Binding="{Binding idCuenta}" Width="45"/>
                                    <DataGridTextColumn Header="Cliente" Binding="{Binding NombreCliente}" Width="160"/>
                                    <DataGridTextColumn Header="DNI" Binding="{Binding DocumentoCliente}" Width="80"/>
                                    <DataGridTextColumn Header="Hora" Binding="{Binding HoraIngreso}" Width="70"/>
                                    <DataGridTextColumn Header="Tiempo" Binding="{Binding TiempoTranscurrido}" Width="80"/>
                                    <DataGridTextColumn Header="Precio" Binding="{Binding precioEntrada, StringFormat=S/. {0:0.00}}" Width="75"/>
                                    <DataGridTextColumn Header="Desc." Binding="{Binding descuento, StringFormat=S/. {0:0.00}}" Width="75"/>
                                    <DataGridTextColumn Header="Total" Binding="{Binding total, StringFormat=S/. {0:0.00}}" Width="75"/>
                                    <DataGridTextColumn Header="Saldo" Binding="{Binding saldo, StringFormat=S/. {0:0.00}}" Width="75"/>
                                    <DataGridTextColumn Header="Estado" Binding="{Binding EstadoCuenta}" Width="*"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </Grid>
                    </Border>
                </Grid>
            </TabItem>

            <!-- TAB 2: CONSUMOS -->
            <TabItem>
                <TabItem.HeaderTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="CartOutline" Width="16" Height="16" VerticalAlignment="Center"/>
                            <TextBlock Text="Gestión de Consumos" Margin="6,0,0,0" VerticalAlignment="Center" FontSize="12"/>
                            <Border Background="#4CC9F018" CornerRadius="8" Padding="5,1" Margin="6,0,0,0">
                                <TextBlock Text="NUEVO" FontSize="8" FontWeight="Bold" Foreground="#4CC9F0"/>
                            </Border>
                        </StackPanel>
                    </DataTemplate>
                </TabItem.HeaderTemplate>

                <Grid Margin="10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="1.1*"/>
                        <ColumnDefinition Width="10"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- PANEL IZQUIERDO: Productos -->
                    <Border Grid.Column="0" Background="#1F2937" CornerRadius="6" Padding="14">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="180"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Título -->
                            <Grid Grid.Row="0" Margin="0,0,0,10">
                                <materialDesign:PackIcon Kind="CartOutline" Width="16" Height="16" Foreground="#4CC9F0" VerticalAlignment="Center" HorizontalAlignment="Left"/>
                                <TextBlock Text="Gestión de Consumos" FontSize="14" FontWeight="SemiBold" Foreground="White" Margin="22,0,0,0" VerticalAlignment="Center"/>
                            </Grid>

                            <!-- Info Cuenta -->
                            <Border Grid.Row="1" 
                                    Background="#4CC9F012" 
                                    BorderBrush="#4CC9F0" 
                                    BorderThickness="1"
                                    CornerRadius="5" 
                                    Padding="10,8" 
                                    Margin="0,0,0,12">
                                <StackPanel>
                                    <TextBlock Text="CUENTA SELECCIONADA" FontSize="8" FontWeight="Bold" Foreground="#4CC9F0" Margin="0,0,0,5"/>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0" Margin="0,0,10,0">
                                            <TextBlock Text="ID:" FontSize="9" Foreground="#9CA3AF"/>
                                            <TextBlock Text="{Binding CuentaSeleccionada.idCuenta}" FontSize="15" FontWeight="Bold" Foreground="#4CC9F0"/>
                                        </StackPanel>
                                        <StackPanel Grid.Column="1">
                                            <TextBlock Text="{Binding CuentaSeleccionada.NombreCliente}" FontSize="12" FontWeight="SemiBold" Foreground="White"/>
                                            <TextBlock FontSize="10" Foreground="#9CA3AF">
                                                <Run Text="DNI:"/>
                                                <Run Text="{Binding CuentaSeleccionada.DocumentoCliente}" FontWeight="Medium" Foreground="White"/>
                                                <Run Text=" | "/>
                                                <Run Text="{Binding CuentaSeleccionada.HoraIngreso}" FontWeight="Medium" Foreground="White"/>
                                            </TextBlock>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <!-- Búsqueda -->
                            <StackPanel Grid.Row="2" Margin="0,0,0,10">
                                <TextBlock Text="Buscar Producto" Foreground="#9CA3AF" FontSize="10" Margin="0,0,0,3" FontWeight="Medium"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="8"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBox Grid.Column="0" x:Name="TxtBuscarProducto"
                                             materialDesign:HintAssist.Hint="Nombre..."
                                             Padding="10,7" FontSize="12" Height="32"/>
                                    <Button Grid.Column="2" Style="{StaticResource MaterialDesignIconButton}"
                                            Width="32" Height="32" Background="#4CC9F018">
                                        <materialDesign:PackIcon Kind="Magnify" Width="16" Height="16" Foreground="#4CC9F0"/>
                                    </Button>
                                </Grid>
                            </StackPanel>

                            <!-- Lista Productos -->
                            <Border Grid.Row="3" Background="#1A1D24" CornerRadius="5" BorderBrush="#374151" BorderThickness="1" Margin="0,0,0,10">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    <Border Grid.Row="0" Background="#14161C" Padding="10,7" BorderBrush="#374151" BorderThickness="0,0,0,1">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="70"/>
                                                <ColumnDefinition Width="50"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="PRODUCTO" FontSize="9" FontWeight="Bold" Foreground="#9CA3AF" VerticalAlignment="Center"/>
                                            <TextBlock Grid.Column="1" Text="PRECIO" FontSize="9" FontWeight="Bold" Foreground="#9CA3AF" TextAlignment="Center" VerticalAlignment="Center"/>
                                            <TextBlock Grid.Column="2" Text="STOCK" FontSize="9" FontWeight="Bold" Foreground="#9CA3AF" TextAlignment="Center" VerticalAlignment="Center"/>
                                        </Grid>
                                    </Border>
                                    <ListBox Grid.Row="1" x:Name="ListProductos" Background="Transparent" BorderThickness="0" ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                                        <ListBox.ItemContainerStyle>
                                            <Style TargetType="ListBoxItem" BasedOn="{StaticResource MaterialDesignListBoxItem}">
                                                <Setter Property="Padding" Value="0"/>
                                                <Setter Property="Margin" Value="0"/>
                                                <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                                <Style.Triggers>
                                                    <Trigger Property="IsSelected" Value="True">
                                                        <Setter Property="Background" Value="#4CC9F018"/>
                                                    </Trigger>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Background" Value="#4CC9F00D"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ListBox.ItemContainerStyle>
                                        <ListBox.ItemTemplate>
                                            <DataTemplate>
                                                <Border Padding="10,8" BorderBrush="#374151" BorderThickness="0,0,0,0.5">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="70"/>
                                                            <ColumnDefinition Width="50"/>
                                                        </Grid.ColumnDefinitions>

                                                        <!-- Nombre del Producto -->
                                                        <TextBlock Grid.Column="0" 
                                                                   Text="{Binding nombre}" 
                                                                   FontSize="11" 
                                                                   FontWeight="SemiBold" 
                                                                   Foreground="White"
                                                                   VerticalAlignment="Center"
                                                                   TextTrimming="CharacterEllipsis"
                                                                   ToolTip="{Binding nombre}"/>

                                                        <!-- Precio -->
                                                        <TextBlock Grid.Column="1" 
                                                                   FontSize="11" 
                                                                   FontWeight="Medium" 
                                                                   Foreground="#4CC9F0"
                                                                   TextAlignment="Center"
                                                                   VerticalAlignment="Center">
                                                            <Run Text="S/. "/>
                                                            <Run Text="{Binding precio, StringFormat={}{0:0.00}}"/>
                                                        </TextBlock>

                                                        <!-- Stock -->
                                                        <Border Grid.Column="2" 
                                                                Background="#4CC9F018" 
                                                                CornerRadius="3" 
                                                                Padding="6,3"
                                                                VerticalAlignment="Center"
                                                                HorizontalAlignment="Center">
                                                            <TextBlock Text="{Binding stock}" 
                                                                       FontSize="10" 
                                                                       FontWeight="Bold" 
                                                                       Foreground="#4CC9F0"
                                                                       TextAlignment="Center"/>
                                                        </Border>
                                                    </Grid>
                                                </Border>
                                            </DataTemplate>
                                        </ListBox.ItemTemplate>

                                        <!-- Datos de ejemplo -->
                                        <ListBoxItem>
                                            <Border Padding="10,8" BorderBrush="#374151" BorderThickness="0,0,0,0.5">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="70"/>
                                                        <ColumnDefinition Width="50"/>
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock Grid.Column="0" Text="Coca Cola 500ml" FontSize="11" FontWeight="SemiBold" Foreground="White" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                                                    <TextBlock Grid.Column="1" Text="S/. 3.50" FontSize="11" FontWeight="Medium" Foreground="#4CC9F0" TextAlignment="Center" VerticalAlignment="Center"/>
                                                    <Border Grid.Column="2" Background="#4CC9F018" CornerRadius="3" Padding="6,3" VerticalAlignment="Center" HorizontalAlignment="Center">
                                                        <TextBlock Text="45" FontSize="10" FontWeight="Bold" Foreground="#4CC9F0"/>
                                                    </Border>
                                                </Grid>
                                            </Border>
                                        </ListBoxItem>
                                        <ListBoxItem>
                                            <Border Padding="10,8" BorderBrush="#374151" BorderThickness="0,0,0,0.5">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="70"/>
                                                        <ColumnDefinition Width="50"/>
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock Grid.Column="0" Text="Cerveza Pilsen" FontSize="11" FontWeight="SemiBold" Foreground="White" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                                                    <TextBlock Grid.Column="1" Text="S/. 7.00" FontSize="11" FontWeight="Medium" Foreground="#4CC9F0" TextAlignment="Center" VerticalAlignment="Center"/>
                                                    <Border Grid.Column="2" Background="#4CC9F018" CornerRadius="3" Padding="6,3" VerticalAlignment="Center" HorizontalAlignment="Center">
                                                        <TextBlock Text="28" FontSize="10" FontWeight="Bold" Foreground="#4CC9F0"/>
                                                    </Border>
                                                </Grid>
                                            </Border>
                                        </ListBoxItem>
                                        <ListBoxItem>
                                            <Border Padding="10,8">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="70"/>
                                                        <ColumnDefinition Width="50"/>
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock Grid.Column="0" Text="Agua Mineral" FontSize="11" FontWeight="SemiBold" Foreground="White" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                                                    <TextBlock Grid.Column="1" Text="S/. 2.00" FontSize="11" FontWeight="Medium" Foreground="#4CC9F0" TextAlignment="Center" VerticalAlignment="Center"/>
                                                    <Border Grid.Column="2" Background="#4CC9F018" CornerRadius="3" Padding="6,3" VerticalAlignment="Center" HorizontalAlignment="Center">
                                                        <TextBlock Text="62" FontSize="10" FontWeight="Bold" Foreground="#4CC9F0"/>
                                                    </Border>
                                                </Grid>
                                            </Border>
                                        </ListBoxItem>
                                    </ListBox>
                                </Grid>
                            </Border>

                            <!-- Agregar -->
                            <Border Grid.Row="4" Background="#1A1D24" CornerRadius="5" Padding="10" Margin="0,0,0,12">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="10"/>
                                        <ColumnDefinition Width="90"/>
                                        <ColumnDefinition Width="12"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0" 
                                               Text="Cantidad:" 
                                               FontSize="11" 
                                               FontWeight="Medium"
                                               Foreground="#9CA3AF" 
                                               VerticalAlignment="Center"/>

                                    <Border Grid.Column="2" 
                                            Background="#14161C" 
                                            BorderBrush="#4CC9F0" 
                                            BorderThickness="1"
                                            CornerRadius="4">
                                        <TextBox x:Name="TxtCantidad" 
                                                 Text="1" 
                                                 TextAlignment="Center" 
                                                 FontSize="14"
                                                 FontWeight="Bold"
                                                 Foreground="White"
                                                 Background="Transparent"
                                                 BorderThickness="0"
                                                 Height="32" 
                                                 VerticalContentAlignment="Center"
                                                 PreviewTextInput="TextBox_NumerosSoloPreviewTextInput"/>
                                    </Border>

                                    <Button Grid.Column="4" 
                                            Style="{StaticResource MaterialDesignRaisedButton}" 
                                            Background="#4CC9F0" 
                                            Height="32" 
                                            FontWeight="SemiBold" 
                                            FontSize="11"
                                            Foreground="#0F1115">
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="Plus" Width="15" Height="15" VerticalAlignment="Center"/>
                                            <TextBlock Text="AGREGAR A CUENTA" Margin="6,0,0,0" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Button>
                                </Grid>
                            </Border>

                            <!-- Consumos Actuales -->
                            <Border Grid.Row="5" Background="#1A1D24" CornerRadius="5" BorderBrush="#374151" BorderThickness="1" Margin="0,0,0,12">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    <Border Grid.Row="0" Background="#14161C" Padding="8,6" BorderBrush="#374151" BorderThickness="0,0,0,1">
                                        <Grid>
                                            <TextBlock Text="CONSUMOS ACTUALES" FontSize="9" FontWeight="Bold" Foreground="#9CA3AF"/>
                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                                <materialDesign:PackIcon Kind="CartCheck" Width="12" Height="12" Foreground="#4CC9F0" VerticalAlignment="Center"/>
                                                <TextBlock Text="3 items" FontSize="9" FontWeight="Bold" Foreground="#4CC9F0" Margin="3,0,0,0" VerticalAlignment="Center"/>
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                    <DataGrid Grid.Row="1" AutoGenerateColumns="False" IsReadOnly="True" CanUserAddRows="False" HeadersVisibility="Column" GridLinesVisibility="None" Background="Transparent" RowBackground="#1F2937" Foreground="White" FontSize="10" BorderThickness="0">
                                        <DataGrid.ColumnHeaderStyle>
                                            <Style TargetType="DataGridColumnHeader">
                                                <Setter Property="Background" Value="Transparent"/>
                                                <Setter Property="Foreground" Value="#9CA3AF"/>
                                                <Setter Property="FontWeight" Value="SemiBold"/>
                                                <Setter Property="FontSize" Value="9"/>
                                                <Setter Property="Padding" Value="6,5"/>
                                            </Style>
                                        </DataGrid.ColumnHeaderStyle>
                                        <DataGrid.CellStyle>
                                            <Style TargetType="DataGridCell">
                                                <Setter Property="BorderThickness" Value="0"/>
                                                <Setter Property="Padding" Value="6,5"/>
                                            </Style>
                                        </DataGrid.CellStyle>
                                        <DataGrid.RowStyle>
                                            <Style TargetType="DataGridRow">
                                                <Setter Property="Height" Value="28"/>
                                            </Style>
                                        </DataGrid.RowStyle>
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Producto" Binding="{Binding NombreProducto}" Width="*"/>
                                            <DataGridTextColumn Header="Cant" Binding="{Binding cantidad}" Width="35"/>
                                            <DataGridTextColumn Header="P.U." Binding="{Binding precioUnitario, StringFormat=S/. {0:0.00}}" Width="55"/>
                                            <DataGridTextColumn Header="Total" Binding="{Binding subtotal, StringFormat=S/. {0:0.00}}" Width="60"/>
                                            <DataGridTemplateColumn Header="" Width="28">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <Button Style="{StaticResource MaterialDesignIconButton}" Width="22" Height="22" Padding="0">
                                                            <materialDesign:PackIcon Kind="Delete" Width="12" Height="12" Foreground="#EF4444"/>
                                                        </Button>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </Grid>
                            </Border>

                            <!-- Total -->
                            <Border Grid.Row="6" Background="#4CC9F018" BorderBrush="#4CC9F0" BorderThickness="2" CornerRadius="5" Padding="12,10">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <!-- Desglose -->
                                    <Grid Grid.Row="0" Margin="0,0,0,6">
                                        <StackPanel>
                                            <TextBlock FontSize="10" Foreground="#9CA3AF" Margin="0,0,0,3">
                                                <Run Text="Entrada:"/>
                                                <Run Text="S/. 20.00" FontWeight="Medium" Foreground="White"/>
                                            </TextBlock>
                                            <TextBlock FontSize="10" Foreground="#9CA3AF" Margin="0,0,0,3">
                                                <Run Text="Descuento:"/>
                                                <Run Text="- S/. 0.00" FontWeight="Medium" Foreground="White"/>
                                            </TextBlock>
                                            <TextBlock FontSize="10" Foreground="#9CA3AF">
                                                <Run Text="Consumos:"/>
                                                <Run Text="+ S/. 12.50" FontWeight="Medium" Foreground="#4CC9F0"/>
                                            </TextBlock>
                                        </StackPanel>
                                    </Grid>

                                    <!-- Total -->
                                    <Border Grid.Row="1" Background="#0F1115" CornerRadius="4" Padding="10,6">
                                        <Grid>
                                            <TextBlock Text="TOTAL A PAGAR" FontSize="10" FontWeight="Bold" Foreground="#9CA3AF" VerticalAlignment="Center"/>
                                            <TextBlock Text="S/. 32.50" FontSize="22" FontWeight="Bold" Foreground="#4CC9F0" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                                        </Grid>
                                    </Border>
                                </Grid>
                            </Border>
                        </Grid>
                    </Border>

                    <!-- PANEL DERECHO: Resumen -->
                    <Border Grid.Column="2" Background="#1A1D24" CornerRadius="6" Padding="14">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Título -->
                            <Grid Grid.Row="0" Margin="0,0,0,10">
                                <materialDesign:PackIcon Kind="CartCheck" Width="16" Height="16" Foreground="#4CC9F0" VerticalAlignment="Center" HorizontalAlignment="Left"/>
                                <TextBlock Text="Resumen de Cuenta" FontSize="14" FontWeight="SemiBold" Foreground="White" Margin="22,0,0,0" VerticalAlignment="Center"/>
                            </Grid>

                            <!-- Contenido -->
                            <Border Grid.Row="1" Background="#1F2937" CornerRadius="5" Padding="14" Margin="0,0,0,10">
                                <TextBlock Text="Selecciona una cuenta pendiente para gestionar sus consumos" 
                                           TextWrapping="Wrap"
                                           Foreground="#6B7280" 
                                           FontSize="12" 
                                           HorizontalAlignment="Center" 
                                           VerticalAlignment="Center"/>
                            </Border>

                            <!-- Total -->
                            <Border Grid.Row="2" Background="#4CC9F018" BorderBrush="#4CC9F0" BorderThickness="2" CornerRadius="5" Padding="12,10">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <Grid Grid.Row="0" Margin="0,0,0,6">
                                        <StackPanel>
                                            <TextBlock FontSize="10" Foreground="#9CA3AF" Margin="0,0,0,3">
                                                <Run Text="Entrada:"/>
                                                <Run Text="S/. 20.00" FontWeight="Medium" Foreground="White"/>
                                            </TextBlock>
                                            <TextBlock FontSize="10" Foreground="#9CA3AF" Margin="0,0,0,3">
                                                <Run Text="Descuento:"/>
                                                <Run Text="- S/. 0.00" FontWeight="Medium" Foreground="White"/>
                                            </TextBlock>
                                            <TextBlock FontSize="10" Foreground="#9CA3AF">
                                                <Run Text="Consumos:"/>
                                                <Run Text="+ S/. 12.50" FontWeight="Medium" Foreground="#4CC9F0"/>
                                            </TextBlock>
                                        </StackPanel>
                                    </Grid>

                                    <Border Grid.Row="1" Background="#0F1115" CornerRadius="4" Padding="10,6">
                                        <Grid>
                                            <TextBlock Text="TOTAL A PAGAR" FontSize="10" FontWeight="Bold" Foreground="#9CA3AF" VerticalAlignment="Center"/>
                                            <TextBlock Text="S/. 32.50" FontSize="22" FontWeight="Bold" Foreground="#4CC9F0" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                                        </Grid>
                                    </Border>
                                </Grid>
                            </Border>
                        </Grid>
                    </Border>
                </Grid>
            </TabItem>
        </TabControl>
    </Grid>
</UserControl>
